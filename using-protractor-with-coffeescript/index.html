<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Using Protractor with CoffeeScript</title>
    <meta name="description" content="I’ve been playing around with AngularJS  for the last couple of weeks during my spare time while being on paternity leave (read late at night). I really like the framework and last night I came across Protractor, the end to end testing framework, and for the first time I think I saw some light in the the UI-testing-tunnel and thought I should share some ideas in a couple of posts...">
    <meta name="author" content="Henrik Lindström">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <script language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
    <link href="/assets/twitter/stylesheets/bootstrap.min.css?0.34174093399328687" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/font-awesome.css?0.6708577702128649" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/jquery.tweet.css?0.5241529245622766" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css?0.707086601976892" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css?0.42882405622337205" type="text/css" rel="stylesheet" media="all">

<script src="/assets/twitter/javascripts/jquery.tweet.js?0.5055980101720793"></script>
 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="/"><i class="icon-search"></i>&nbsp;a life in search</a>
        <ul class="nav">
            
              <li><a href="/archive">Archive</a></li>
            
              <li><a href="/tags">Tags</a></li>
            
              <li><a href="/categories">Categories</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="background">
    <div class="container">

      <div class="content">
        <div class="page-header">
  <h1>Using Protractor with CoffeeScript </h1>
</div>

<div class="row">
  <div class="span10">
    <p><span>I&#39;ve been playing around with AngularJS  for the last couple of weeks during my spare time while being on paternity leave (read: late at night). I really like the framework and last night I came across Protractor, the end to end testing framework, and for the first time I think I saw some light in the the UI-testing-tunnel and thought I should share some ideas in a couple of posts. First I&#39;ll start with how to use Protractor with CoffeScript and how to get a nice fluent syntax in your testing scenarios (thanks to <a href="https://github.com/angular/protractor/issues/275#issuecomment-29106082">cyranix</a> for getting me inspired).</span></p>

<h2>Using Protractor with CoffeeScript</h2>

<p><span>I like using CoffeScript (even though I&#39;m kind of verbose when I use it compared to most as I like keeping the parentheses) and thought it would be great if I could write my Page Objects as CoffeScript classes and chain the functions giving me a fluent syntax like:</span></p>

<pre>
startPage.
    .clickLogin()
            .setUserName('john.doe@acme.com')
            .setPassword(‘donttellanyone’)
            .submit()
    browser.waitForAngular()
    
    expect(browser.getLocationAbsUrl()).toMatch('/app/#!/dashboard')
</pre>

<p><span>So, how do we do this? First we need to register CoffeScript in the protractor configuration to be able to use it in our scenarios:</span></p>

<p><span><i>protractor-conf.js</i></span></p>

<pre>
exports.config = {
    allScriptsTimeout: 11000,

    specs: [
        'e2e/*.scenarios.coffee'
    ],

    capabilities: {
        'browserName': 'chrome'
    },

    baseUrl: 'http://localhost:10000/app',

    framework: 'jasmine',

    jasmineNodeOpts: {
        defaultTimeoutInterval: 30000
    }
};
</pre>

<p><span>Note: If you don’t have CoffeScript installed grab it with:</span></p>

<pre>npm install coffee-script</pre>

<p><span>Next we need to create our Page Objects and we will start with the <i>start page</i>:</span></p>

<p><span><i>start_page.coffee</i></span></p>

<pre>
LoginPage = require('./login_page')

class StartPage
    constructor: ->
        @loginLink = element(By.id('loginLink'))

    get: ->
        browser.get('app/#!/')
        return @

    clickLogin: ->
        @loginLink.click()
        browser.waitForAngular()
        return new LoginPage()

module.exports = StartPage
</pre>

<p><span>We grab the login link element in the constructor (I&#39;ve just set the id in the html view so that it is easy to get hold of in the tests and making the test a bit more robust if I decide to move the login link). When someone then clicks login we click the link and wait for angular to complete the request and then we return the Page Object for the <i>login page</i>.<span></p>

<p><span>The Page Object for the <i>login page</i> looks similar in structure but have a username and password field that the user can fill out (Here I use the <i>By.model</i>i to get hold of the input fields for the username and password. Also note that I use return @ to return <i>this</i> in the functions to make it chainable):</span></p>

<p><span><i>login_page.coffee</i></span></p>

<pre>
LoginPage = require('./login_page')

class LoginPage
    constructor: ->
        @username = element(By.model('user.name'))
        @password = element(By.model('user.password'))
        @loginButton = element(By.id('loginButton'))
        @errorMessage = element(By.id('loginErrorMessage'))

    get: ->
        browser.get('app/#!/auth/login')
        return @

    getErrorMessage: ->
        return @errorMessage.getText()

    setUserName: (text) ->
        @username.sendKeys(text)
        return @

    clearUserName: ->
        @username.clear()
        return @

    setPassword: (text) ->
        @password.sendKeys(text)
        return @

    clearPassword: ->
        @password.clear()
        return @

    submit: ->
        @loginButton.click()

module.exports = LoginPage
</pre>

<p><span>Now we can simply <i>require</i> the <i>start page</i> Page Object in our scenarios to get the fluent syntax in our testing scenario:</span></p>

<p><span><i>login.scenarios.coffee</i></span></p>

<pre>
StartPage = require('../PageObjects/start_page')

describe('<e2e>', () ->
    loginPage = null

    beforeEach(() ->
        startPage = new StartPage()
        startPage.get()
        loginPage = startPage.clickLogin()
    )

    describe('login', () ->
        it('should login and redirect to the dashboard with valid user credentials', () ->
            loginPage
                .setUserName('john.doe@acme.com')
                .setPassword('donttellanyone')
                .submit()
            browser.waitForAngular()
            
            expect(browser.getLocationAbsUrl()).toMatch('/app/#!/dashboard')
        )

...more tests
}
</pre>

<p><span>This way we get a nice structure and a pretty neat fluent syntax in our testing scenarios. Next up is how to bootstrap your server/database before each test scenario so that you can make integration test scenarios from a consistent state every time. I&#39;ll get back to that in a future post.</span></p>

    
    <div class="pagination">
      <ul>
        <ul>
            <li class="prev"><a href="/language-detection-using-elasticsearch" title="Language detection using Elasticsearch">&larr; Previous</a></li>

            <li><a href="/archive">Archive</a></li>

            <li class="next disabled"><a>Next &rarr;</a>
        </ul>
      </ul>
    </div>
    <hr>
    <div id="disqus_thread"></div>
<script>
    var disqus_developer = 1;
    var disqus_shortname = 'alifeinsearch'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
  
  <div class="span2">
    <h4>By</h4>
    <div><span><a href="https://profiles.google.com/110888837133566849493" target="_blank" rel="me">Henrik Lindström</a></span></div>
    <br>
    <h4>Published</h4>
    <div class="date"><span>2014-05-12</span></div>
    <br>
    <h4>Categories</h4>
    <ul class="tag_box">
      <li>
        <a href="/categories#angularjs-ref">angularjs <span>1</span></a>
      </li>    </ul>
    <br>
    <h4>Tags</h4>
    <ul class="tag_box">
      <li>
        <a href="/tags#angularjs-ref">angularjs <span>1</span></a>
      </li>      <li>
        <a href="/tags#testing-ref">testing <span>1</span></a>
      </li>    </ul>
  </div>
</div>

      </div>

      <footer>
        <p>&copy; Henrik Lindström 2012 
          with help from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>, <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
          and <a href="http://fortawesome.github.com/Font-Awesome/" target="_blank">Font Awesome</a>
        </p>
      </footer>

    </div> <!-- /container -->
    
    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    <script>
  var _gaq=[['_setAccount','UA-34278256-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
  </div>
  </body>
</html>
