<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Hierarchical faceting with EPiServer Find</title>
    <meta name="description" content="A quite common use case of facets is to show a listing of the number of documents in a result for the different categories on the site (quite common is maybe an understatement as this is often the &quot;hello world!&quot; of faceting). A document can occur in maybe one or more categories and this is where your search index really stands out since it doesn’t care if you have one or two categories associated with the document it will return your facet in no time anyway. Sometimes your categories have a hierarchical structure that you want to reflect in your facet...">
    <meta name="author" content="Henrik Lindström">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <script language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
    <link href="/assets/twitter/stylesheets/bootstrap.min.css?0.08240277104742744" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/font-awesome.css?0.8859064420519254" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/jquery.tweet.css?0.9666528099301965" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css?0.4446642646586121" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css?0.6599877008462586" type="text/css" rel="stylesheet" media="all">

<script src="/assets/twitter/javascripts/jquery.tweet.js?0.040287511575027635"></script>
 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/"><i class="icon-search"></i>&nbsp;a life in search</a>
          <ul class="nav">
              
                <li><a href="/archive">Archive</a></li>
              
                <li><a href="/tags">Tags</a></li>
              
                <li><a href="/categories">Categories</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        <div class="page-header">
  <h1>Hierarchical faceting with EPiServer Find </h1>
</div>

<div class="row">
  <div class="span8">
    <p><span>A quite common use case for facets is to show a listing of the number of documents in a result for the different categories on the site (quite common is maybe an understatement as this is often the “hello world!” of faceting). A document can occur in maybe one or more categories and this is where your search index really stands out since it doesn’t care if you have one or two categories associated with the document it will return your facet in no time anyway. Sometimes your categories have a hierarchical structure that you want to reflect in your facet. Lets say that you have documents about cars and want to have a category tree based on manufacturer and name, ie. Volvo/XC60. How can you achieve a facet where you get an aggregated count for each level in the category tree? For example:</span></p>

<pre>
Volkswagen (7)
    Passat (5)
    Tiguan (2)
Volvo (10)
    V70 (5)
    V60 (2)
    …
</pre>

<p><span>The simplest way of doing this is by associating each document with all levels for each of its categories. Then by using a terms facet when fetching your result you will get an aggregated count for each node in your category tree. Voila, there is your hierarchical facet but with just a few lines of code you can get Find to do all that dirty work of your hands and all you have to do is to pass a category string (each level separated by a ‘/’) and return a facet that parse the result and reflects the nested structure of the category tree. I will leave out the implementation details but at <a href="https://github.com/x2find/HierarchicalFacet2Find">HierarchicalFacet2Find</a> you can fetch your own copy of the code that does that work for you.</span></p>

<h2>How to use the HierarchicalFacet2Find extension</h2>

<p><span>Add a Hierarchy property to the document:</span></p>

<pre>
public class Document
{
    [Id]
    public string Id { get; set; }

    public Hierarchy Hierarchy { get; set; }
}
</pre>

<p><span>Set the hierarchy path:</span></p>

<pre>
document.Hierarchy = "A/B/C/D";
</pre>

<p><span>Index and request a HierarchicalFacet when searching:</span></p>

<pre>
result = client.Search<Document>()
            .HierarchicalFacetFor(x => x.Hierarchy)
            .GetResult();
</pre>

<p><span>Fetch it from the result:</span></p>

<pre>
facet = result.HierarchicalFacetFor(x => x.Hierarchy)
</pre>

<p><span>Loop over the nested hierarchy paths:</span></p>

<pre>
foreach(var hierarchyPath in facet)
{
    hierarchyPath.Path;
    hierarchyPath.Count;

    foreach (var subHierarchyPath in hierarchyPath)
    {
        subHierarchyPath.Path;
        subHierarchyPath.Count;
        ...
    }
}
</pre>

<p><span>I hope you may find this useful when making your site awesome with EPiServer Find!</span></p>

    
    <div class="pagination">
      <ul>
        <ul>
            <li class="prev"><a href="/time-to-live-with-episerver-find" title="Time to live with EPiServer Find">&larr; Previous</a></li>

            <li><a href="/archive">Archive</a></li>

            <li class="next"><a href="/categorizing-using-elasticsearch" title="Categorizing using Elasticsearch">Next &rarr;</a></li>
        </ul>
      </ul>
    </div>
    <hr>
    <div id="disqus_thread"></div>
<script>
    var disqus_developer = 1;
    var disqus_shortname = 'alifeinsearch'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
  
  <div class="span4">
    <h4>By</h4>
    <div><span><a href="https://profiles.google.com/110888837133566849493" target="_blank" rel="me">Henrik Lindström</a></span></div>
    <br>
    <h4>Published</h4>
    <div class="date"><span>2013-02-26</span></div>
    <br>
    <h4>Categories</h4>
    <ul class="tag_box">
      <li>
        <a href="/categories#EPiServer-ref">EPiServer <span>5</span></a>
      </li>    </ul>
    <br>
    <h4>Tags</h4>
    <ul class="tag_box">
      <li>
        <a href="/tags#EPiServer-ref">EPiServer <span>5</span></a>
      </li>      <li>
        <a href="/tags#EPiServer.Find-ref">EPiServer.Find <span>5</span></a>
      </li>    </ul>
  </div>
</div>

      </div>

      <footer>
        <p>&copy; Henrik Lindström 2012 
          with help from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>, <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
          and <a href="http://fortawesome.github.com/Font-Awesome/" target="_blank">Font Awesome</a>
        </p>
      </footer>

    </div> <!-- /container -->
    
    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    <script>
  var _gaq=[['_setAccount','UA-34278256-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
  </body>
</html>
