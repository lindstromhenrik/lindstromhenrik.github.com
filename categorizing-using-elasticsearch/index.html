<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Categorizing using Elasticsearch | a life in search</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Categorizing using Elasticsearch" />
<meta name="author" content="Henrik Lindström" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’m fortunate to work at a company that once a month have a ‘hack day’ when we are allowed to just try out new and crazy ideas. As an advocate of using search for so much more than just the ‘search page’ I decided to do a small demo of how to use Elasticsearch to do categorization and I wanted to share some of my ideas…" />
<meta property="og:description" content="I’m fortunate to work at a company that once a month have a ‘hack day’ when we are allowed to just try out new and crazy ideas. As an advocate of using search for so much more than just the ‘search page’ I decided to do a small demo of how to use Elasticsearch to do categorization and I wanted to share some of my ideas…" />
<link rel="canonical" href="https://www.lindstromhenrik.com/categorizing-using-elasticsearch/" />
<meta property="og:url" content="https://www.lindstromhenrik.com/categorizing-using-elasticsearch/" />
<meta property="og:site_name" content="a life in search" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-03-08T00:00:00+01:00" />
<script type="application/ld+json">
{"description":"I’m fortunate to work at a company that once a month have a ‘hack day’ when we are allowed to just try out new and crazy ideas. As an advocate of using search for so much more than just the ‘search page’ I decided to do a small demo of how to use Elasticsearch to do categorization and I wanted to share some of my ideas…","author":{"@type":"Person","name":"Henrik Lindström"},"@type":"BlogPosting","url":"https://www.lindstromhenrik.com/categorizing-using-elasticsearch/","headline":"Categorizing using Elasticsearch","dateModified":"2013-03-08T00:00:00+01:00","datePublished":"2013-03-08T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lindstromhenrik.com/categorizing-using-elasticsearch/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://www.lindstromhenrik.com/feed.xml" title="a life in search" /><script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-34278256-1', 'auto');
    ga('send', 'pageview');
    ga('set', 'anonymizeIp', true);
    </script></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">a life in search</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Categorizing using Elasticsearch</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2013-03-08T00:00:00+01:00" itemprop="datePublished">Mar 8, 2013
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><span>I’m fortunate to work at a company that once a month have a ‘hack day’ when we are allowed to just try out new and crazy ideas. As an advocate of using search for so much more than just the ‘search page’ I decided to do a small demo of how to use Elasticsearch to do categorization and I wanted to share some of my ideas.</span></p>

<h2>The approach</h2>
<p><span>We often have a large amount of data that we know falls into different categories and that we can use as a sample space for predicting unseen data. If we index all this data that we have and look at the unseen data as ‘queries’ we should be able to construct queries where the score when querying the known data space represent a similarity between the ‘objects’. However, now that we have a result where each ‘object’ in the result has a similarity score with the ‘queried’ object how should we interpret it? What if we group all items in the results by each category that we know that they fall into and then calculate the avg similarity score within that group and return the category for which the avg score is the highest? Depending on your data and problem space constructing the similarity query might be more or less easy but the beauty of this approach is that is very easy to implement in Elasticsearch using parent-child mappings.</span></p>

<h2>Demo: Implementing a language categorizer</h2>
<p><span>We start by creating an index (I’ve named it ‘myindex’) and add a parent mapping between a category type and a data type:</span></p>

<pre>
http://localhost:9200/myindex
{
    "mappings": {
        "data": {
            "_parent": {
                "type": "category"
            }
        }
    }
}
</pre>

<p><span>Then we add the known categories:</span></p>

<pre>
http://localhost:9200/myindex/category/sv
{
    "name": "Swedish"
}
...
</pre>

<p><span>For the ‘known’ data we index it and relate it to the parent category:</span></p>

<pre>
http://localhost:9200/myindex/data/1?parent=sv
{
    "text": "det här är en text skriven på svenska"
}
...
</pre>

<p><span>Using the has_child-query we can then easily achieve the described approach of searching for categories and have them returned based on the avg score of a child-query issued on the data. (In this case we just do a simple query_string-query with the text we want do do language detection for, ‘en svensk text’):</span></p>

<pre>
http://localhost:9200/myindex/category/_search
{
  "query":{
    "has_child": {
      "type": "data",
      "score_type" : "avg",
      "query" : {
        "query_string": {
          "query": "en svensk text"
        }
      }
    }
  }
}
</pre>

<p><span>Resulting in:</span></p>

<pre>
{
    "took": 27,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "failed": 0
    },
    "hits": {
        "total": 1,
        "max_score": 0.3125,
        "hits": [
            {
                "_index": "myindex",
                "_type": "category",
                "_id": "sv",
                "_score": 0.3125,
                "_source": {
                    "name": "Swedish"
                }
            }
        ]
    }
}
</pre>

<p><span>Voila! In just 4 steps you know have your very own language detector.</span></p>

<h2>Discussion</h2>
<p><span>The described language detector might be a bit simplistic but can easily be more advanced by adding more advanced analyzers for your indexed data using stemmers or alike for the appropriate language. However the approach can be tweaked to do much more advanced queries on more complex objects using all the fancy query types available in Elasticsearch (just ignore the ConstantScore-query ;-)). Only your imagination stops you from creating appropriate similarity queries that might give you really good results in just a few easy steps!</span></p>

<p><span>So stop looking at your ‘search engine’ as a search page provider and see it as a great tool for not just querying but also a great source for analyzing your data!</span></p>

<h3>Note:</h3>
<p><span>The Elasticsearch0.20.x releases have a bug in the has_child-query calculating the sum and not the avg score when using the score_type=avg. I’ve issued a <a href="https://github.com/elasticsearch/elasticsearch/pull/2747">pull request</a> but if you want to try it out you can clone and build from the master branch where the upgraded Lucene distribution circumvents the problem.</span></p>

  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://www.lindstromhenrik.com/categorizing-using-elasticsearch/';
      this.page.identifier = 'https://www.lindstromhenrik.com/categorizing-using-elasticsearch/';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://alifeinsearch.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/categorizing-using-elasticsearch/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">a life in search</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Henrik Lindström</li><li><a class="u-email" href="mailto:lindstromhenrik@gmail.com">lindstromhenrik@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/lindstromhenrik"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">lindstromhenrik</span></a></li><li><a href="https://www.twitter.com/lindstromhenrik"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">lindstromhenrik</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
